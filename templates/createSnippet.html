{% extends "layout.html" %}

{% block title %}Create Snippet - Snippet Oracle{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <h1 class="title">Create a New Snippet</h1>
        <p class="subtitle">Easily save and manage your code snippets.</p>

        <form method="post" class="box">
            <div class="field">
                <label class="label" for="name">Snippet Name</label>
                <div class="control">
                    <input class="input" type="text" name="name" placeholder="Enter snippet name" required>
                </div>
            </div>

            <div class="field">
                <label class="label" for="code">Code</label>
                <div class="control">
                    <textarea class="textarea" name="code" placeholder="Paste your code here" required></textarea>
                </div>
            </div>

            <div class="field">
                <label class="label" for="description">Description</label>
                <div class="control">
                    <textarea class="textarea" name="description" placeholder="Optional description"></textarea>
                </div>
            </div>

            <!-- Tags Input Section -->
            <div class="field">
                <label class="label has-text-primary" for="tags">Tags</label>
                <div class="control">
                    <div class="tagsfield field input is-grouped is-grouped-multiline">
                        <div id="tags-container" class="tags is-flex is-flex-wrap-wrap">
                            <input type="hidden" name="tags" id="hidden-tags">
                            <span id="tag-input" class="tag-input" placeholder="Type tags and press Enter" contenteditable></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visibility Toggle (Public/Private) -->
            <div class="field">
                <label class="label">Visibility</label>
                <div class="control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="visibilityToggle" name="is_public">
                        <span class="slider">
                            <i class="fas fa-lock"></i> <span class="toggle-text">Private</span>
                        </span>
                    </label>
                </div>
            </div>

                <!-- Dropdown for Preset Tags -->
                <div class="control">
                    <div class="dropdown" id="tag-dropdown">
                        <div class="dropdown-trigger">
                            <button type="button" class="button is-primary" id="dropdown-button" aria-haspopup="true" aria-controls="dropdown-menu">
                                <span>Select a Tag</span>
                                <span class="icon is-small">
                                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                                </span>
                            </button>
                        </div>
                        <div class="dropdown-menu" id="dropdown-menu" role="menu">
                            <div class="dropdown-content">
                                {% for tag in preset_tags %}
                                    <a href="#" class="dropdown-item preset-tag">{{ tag }}</a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field">
                <div class="control">
                    <button class="button is-link is-fullwidth" type="submit">Create Snippet</button>
                </div>
            </div>
        </form>

        <div class="buttons is-centered mt-4">
            <a class="button is-light" href="{{ url_for('snippets') }}">Back to My Snippets</a>
        </div>
    </div>
</section>

<style>
/* Custom Switch Style */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 100px;
    height: 38px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ddd;
    transition: 0.4s;
    border-radius: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: white;
    font-weight: bold;
    padding: 0 12px;
    width: 100%;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
}

.slider i {
    margin-right: 8px;
}

input:checked + .slider {
    background-color: #3273dc; /* Bulma primary color */
}

input:checked + .slider i {
    content: "\f0ac"; /* FontAwesome globe icon */
}

input:checked + .slider .toggle-text {
    content: "Public";
}

/* Smooth Transition */
.slider, .slider i, .toggle-text {
    transition: 0.4s;
}
</style>

<script>
// Visibility Toggle Handler
document.getElementById("visibilityToggle").addEventListener("change", function() {
    let slider = this.nextElementSibling;
    let icon = slider.querySelector("i");
    let text = slider.querySelector(".toggle-text");

    if (this.checked) {
        icon.classList.remove("fa-lock");
        icon.classList.add("fa-globe");
        text.textContent = "Public";
    } else {
        icon.classList.remove("fa-globe");
        icon.classList.add("fa-lock");
        text.textContent = "Private";
    }
});
</script>

<script src="{{ url_for('static', filename='tag_handler.js') }}"></script>
{% endblock %}