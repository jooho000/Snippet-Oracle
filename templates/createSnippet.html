{% extends "layout.html" %}

{% block title %}Create Snippet - Snippet Oracle{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="box p-5">
            <h1 class="title has-text-centered">Create a New Snippet</h1>
            <p class="subtitle has-text-centered">Save and manage your code snippets efficiently.</p>

            <form method="post">
                <!-- Snippet Name -->
                <div class="field">
                    <label class="label">Snippet Name</label>
                    <div class="control">
                        <input class="input is-medium is-rounded" type="text" name="name" placeholder="Enter snippet name" required>
                    </div>
                </div>

                <!-- Snippet Code -->
                <div class="field">
                    <label class="label">Code</label>
                    <div class="control">
                        <textarea class="textarea is-medium is-family-code" name="code" placeholder="Paste your code here" rows="6" required></textarea>
                    </div>
                </div>

                <!-- Snippet Description -->
                <div class="field">
                    <label class="label">Description</label>
                    <div class="control">
                        <textarea class="textarea" name="description" placeholder="Optional description"></textarea>
                    </div>
                </div>

            <!-- Tags Input Section -->
            <div class="field">
                <label class="label has-text-primary" for="tags">Tags</label>
                <div class="control">
                    <div class="tagsfield field input is-grouped is-grouped-multiline">
                        <div id="tags-container" class="tags is-flex is-flex-wrap-wrap">
                            <input type="hidden" name="tags" id="hidden-tags">
                            <span id="tag-input" class="tag-input" placeholder="Type tags and press Enter" contenteditable></span>
                        </div>

                <!-- Visibility Toggle as a Button -->
                <div class="field">
                    <label class="label">Visibility</label>
                    <div class="control">
                        <button type="button" id="visibilityToggle" class="button is-light is-rounded">
                            <span class="icon">
                                <i id="visibilityIcon" class="fas fa-lock"></i>
                            </span>
                            <span id="toggleText">Private</span>
                        </button>
                        <input type="hidden" name="is_public" id="isPublic" value="0">
                    </div>
                </div>

                <!-- User Selection (Only visible if Private) -->
                <div class="field" id="permittedUsersField" style="display: none;">
                    <label class="label">Share with Specific Users</label>
                    <div class="box is-shadowless">
                        <div class="field">
                            <input type="text" id="userSearch" class="input is-rounded" placeholder="Search users...">
                        </div>
                        <div id="selected-users" class="tags are-medium"></div>
                        <div id="user-selection" class="box is-light" style="display: none;"></div>
                    </div>
                </div>

                <!-- Dropdown for Preset Tags -->
                <div class="control">
                    <div class="dropdown" id="tag-dropdown">
                        <div class="dropdown-trigger">
                            <button type="button" class="button is-primary" id="dropdown-button" aria-haspopup="true" aria-controls="dropdown-menu">
                                <span>Select a Tag</span>
                                <span class="icon is-small">
                                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                                </span>
                            </button>
                        </div>
                        <div class="dropdown-menu" id="dropdown-menu" role="menu">
                            <div class="dropdown-content">
                                {% for tag in preset_tags %}
                                    <a href="#" class="dropdown-item preset-tag">{{ tag }}</a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="field">
                <div class="control">
                    <button class="button is-link is-fullwidth" type="submit">Create Snippet</button>
                <!-- Submit Button -->
                <div class="field mt-4">
                    <div class="control">
                        <button class="button is-primary is-fullwidth is-medium is-rounded">Create Snippet</button>
                    </div>
                </div>
            </form>

            <!-- Back Button -->
            <div class="has-text-centered mt-4">
                <a class="button is-light is-rounded" href="{{ url_for('snippets') }}">Back to My Snippets</a>
            </div>
        </div>
    </div>
</section>

<script id="user-data" type="application/json">
    {{ all_users | tojson | safe }}
</script>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='userSelection.js') }}"></script>
{% endblock %}
              
{% block scripts %}
<script src="{{ url_for('static', filename='tag_handler.js') }}"></script>
{% endblock %}

